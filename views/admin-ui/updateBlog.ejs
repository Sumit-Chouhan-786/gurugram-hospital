<!-- Include the admin header -->
<%- include('../layout/admin-header.ejs') %>

    <section class="vh-100 d-flex flex-column">
        <nav class="d-flex justify-content-between align-items-center navbar px-sm-3 px-2 py-3 bg-dark">
            <div class="d-flex align-items-center gap-2">
                <div onclick="toggleSidebar()" class="d-lg-none d-flex flex-column justify-content-between toggle_icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <a class="text-white" href="/admin/dashboard"><img height="45" width="45" class="w-100"
                        src="/assets/img/admin/logo.png" alt="logo"></a>
            </div>
            <a class="text-white d-flex align-items-center gap-2" href="/admin/logout">Logout<i
                    class="fa-solid fa-right-from-bracket pt-1"></i></a>
        </nav>
        <div class="flex-grow-1 overflow-hidden">
            <div class="row h-100 overflow-hidden">
            <div class="col-xl-2 h-100 col-lg-3 px-0 overflow_scroll sidebar_col bg-light">
                <div class="sidebar">
                    <div class="accordion overflow_x_hidden" id="accordionExample">
            
                        <a href="/admin/dashboard"
                            class="d-flex bg-white mb-2 justify-content-start w-100 ps-xl-5 align-items-center py-2">
                            <i class="fa-solid fa-house"></i>Dashboard
                        </a>
                        <a href="/admin/site-setting-display"
                            class="d-flex bg-white mb-2 justify-content-start  w-100 ps-xl-5 align-items-center py-2">
                            <i class="fas fa-cogs"></i>Site Setting
                        </a>
            
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <span
                                    class="accordion-button collapsed d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false"
                                    aria-controls="collapseTwo">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fas fa-sliders"></i>
                                        Slider</div>
            
                                </span>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingTwo"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-slider" class="sub-item">Add Slider</a>
                                    <a href="/admin/all-slider" class="sub-item">All Slider</a>
                                </div>
                            </div>
                        </div>
                        <!-- More accordion items -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <span
                                    class="accordion-button collapsed d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false"
                                    aria-controls="collapseThree">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i
                                            class="fa-brands fa-servicestack"></i>
                                        Services</div>
                                </span>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingThree"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-service" class="sub-item">Add Services</a>
                                    <a href="/admin/all-services" class="sub-item">All Services</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <span
                                    class="accordion-button collapsed d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false"
                                    aria-controls="collapseFour">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fas fa-pagelines"></i>
                                        Pages</div>
                                </span>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingFour"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-page" class="sub-item">Add Pages</a>
                                    <a href="/admin/all-pages" class="sub-item">All Pages</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSeven">
                                <span
                                    class="accordion-button collapsed d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven" aria-expanded="false"
                                    aria-controls="collapseSeven">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i
                                            class="fa-solid fa-universal-access"></i>
                                        Testimonial</div>
                                </span>
                            </h2>
                            <div id="collapseSeven" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingSeven"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-testimonial" class="sub-item">Add Testimonial</a>
                                    <a href="/admin/all-testimonial" class="sub-item">All Testimonial</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFive">
                                <span
                                    class="accordion-button collapsed  d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false"
                                    aria-controls="collapseFive">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fa-solid fa-image"></i>
                                        Image Gallery</div>
                                </span>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingFive"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-image-gallery" class="sub-item">Add Gallery</a>
                                    <a href="/admin/all-image-gallery" class="sub-item">All Gallery</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingNine">
                                <span
                                    class="accordion-button collapsed  d-flex  align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine" aria-expanded="false"
                                    aria-controls="collapseNine">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fa-solid fa-video"></i>
                                        Video Gallery</div>
                                </span>
                            </h2>
                            <div id="collapseNine" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingNine"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-video-gallery" class="sub-item">Add Video</a>
                                    <a href="/admin/all-video-gallery" class="sub-item">All Video</a>
                                </div>
                            </div>
                        </div>
                        <a href="/admin/enquire"
                            class="d-flex bg-white my-2 justify-content-start  w-100 ps-xl-5 align-items-center py-2">
                            <i class="fa-solid fa-calendar-check"></i>Enquire
                        </a>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingeleven">
                                <span
                                    class="accordion-button collapsed d-flex align-items-center justify-content-between pe-2 ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseeleven" aria-expanded="false"
                                    aria-controls="collapseeleven">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fas fa-users"></i>
                                        Team</div>
                                </span>
                            </h2>
                            <div id="collapseeleven" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingThree"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-team" class="sub-item">Add Team</a>
                                    <a href="/admin/all-team" class="sub-item">All Team</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSix">
                                <span
                                    class="accordion-button collapsed pe-2 d-flex gap-3 align-items-center justify-content-between ps-xl-5 py-2"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false"
                                    aria-controls="collapseSix">
                                    <div class="d-flex align-content-center gap-3 fw-medium"><i class="fas fa-blog"></i>
                                        Blog</div>
                                </span>
                            </h2>
                            <div id="collapseSix" class="accordion-collapse collapse ps-xl-5" aria-labelledby="headingSix"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <a href="/admin/add-blog" class="sub-item">Add Blog</a>
                                    <a href="/admin/all-blogs" class="sub-item">All Blogs</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                <div class="col-xl-10 col-lg-9 bg_gray h-100 col-12 mb-3 overflow_scroll d-flex justify-content-center">
                    <div class="w-100 mt-3 p-3">
                        <h2>Update Blog</h2>
                        <form action="/admin/update-blog/<%= blog.id %>" method="POST" enctype="multipart/form-data"
                            id="blogForm">
                            <!-- Blog ID (hidden) -->
                            <input type="hidden" name="id" value="<%= blog.id %>">

                            <!-- Blog Title Input -->
                            <div class="mb-3">
                                <label for="blogTitle" class="form-label">Blog Title</label>
                                <input type="text" name="title" class="form-control" id="blogTitle"
                                    value="<%= blog.title %>" placeholder="Enter Blog Title" required>
                            </div>

                            <!-- Blog Heading Input -->
                            <div class="mb-3">
                                <label for="blogHeading" class="form-label">Blog Heading</label>
                                <input type="text" name="heading" class="form-control" id="blogHeading"
                                    value="<%= blog.heading %>" placeholder="Enter Blog Heading" required>
                            </div>

                            <!-- Image Field -->
                            <div class="mb-3">
                                <label for="blogImage" class="form-label">Blog Image</label><br />
                                <input id="blogImage" type="file" name="blogImage" />
                                <% if (blog.image) { %>
                                    <div class="mt-2">
                                        <img src="/uploads/<%= blog.image %>" alt="current-image" height="100">
                                    </div>
                                    <% } %>
                            </div>

                            <!-- Blog Description Input (with TinyMCE Editor) -->
                            <div class="mb-3">
                                <label for="description" class="form-label">Blog Description</label>
                                <textarea name="description" class="form-control" id="description" rows="4"
                                    placeholder="Enter Blog Description" required><%= blog.description %></textarea>
                            </div>

                            <!-- SEO Section -->
                            <h5 class="bg-success p-2 rounded-2 text-white">SEO Information</h5>

                            <!-- SEO Title Input -->
                            <div class="mb-3">
                                <label for="seoTitle" class="form-label">SEO Title</label>
                                <input type="text" name="seoTitle" class="form-control" id="seoTitle"
                                    value="<%= blog.seoTitle %>" placeholder="Enter SEO Title" required>
                            </div>

                            <!-- SEO Keywords Input -->
                            <div class="mb-3">
                                <label for="seoKeywords" class="form-label">SEO Keywords</label>
                                <input type="text" name="seoKeywords" class="form-control" id="seoKeywords"
                                    value="<%= blog.seoKeywords %>" placeholder="Enter SEO Keywords" required>
                            </div>

                            <!-- SEO Description Input (with TinyMCE Editor) -->
                            <div class="mb-3">
                                <label for="seoDescription" class="form-label">SEO Description</label>
                                <textarea name="seoDescription" class="form-control" id="seoDescription" rows="4"
                                    placeholder="Enter SEO Description" required><%= blog.seoDescription %></textarea>
                            </div>
                            <!-- Status Dropdown Input -->
                            <div class="mb-3">
                                <label for="statusDropdown" class="form-label">Status</label>
                                <div class="dropdown">
                                    <select class="form-select" name="status" id="statusDropdown" required>
                                        <option value="" disabled>-- Select Status --</option>
                                        <option value="active" <%=blog.status==="active" ? "selected" : "" %>>Active
                                            &#10004;</option>
                                        <option value="deactive" <%=blog.status==="deactive" ? "selected" : "" %>
                                            >Deactive &#10004;</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Submit Button -->
                            <button type="submit" class="btn submit_btn btn-primary w-100 mb-4">Update</button>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </section>



    <script>
        tinymce.init({
            selector: '#description, #seoDescription',
            plugins: 'advlist autolink lists link image charmap print preview anchor',
            toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image',
            setup: function (editor) {
                editor.on('init', function () {
                    console.log('TinyMCE initialized');
                    // Make sure the textarea is visible
                    document.querySelector('#description').style.display = 'block';
                    document.querySelector('#seoDescription').style.display = 'block';
                });
            }
        });

        const form = document.querySelector('#blogForm');
        form.addEventListener('submit', (event) => {
            const descriptionTextarea = document.querySelector('#description');
            const seoDescriptionTextarea = document.querySelector('#seoDescription');

            // Get content from TinyMCE editors
            const descriptionContent = tinymce.get('description').getContent();
            const seoDescriptionContent = tinymce.get('seoDescription').getContent();

            // Ensure TinyMCE content is transferred to the textareas before submitting
            descriptionTextarea.value = descriptionContent;
            seoDescriptionTextarea.value = seoDescriptionContent;

            // Check if either description or seoDescription is empty
            if (!descriptionContent.trim()) {
                alert('Description is required.');
                event.preventDefault();  // Prevent form submission
                descriptionTextarea.focus();
                return;
            }

            if (!seoDescriptionContent.trim()) {
                alert('SEO Description is required.');
                event.preventDefault();  // Prevent form submission
                seoDescriptionTextarea.focus();
                return;
            }

            console.log('Description:', descriptionContent);
            console.log('SEO Description:', seoDescriptionContent);
        });
    </script>